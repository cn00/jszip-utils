<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>jszip-viewer</title>
    <meta name="description" content="jszip-viewer">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js">
    <script type="text/javascript" src="https://stuk.github.io/jszip/dist/jszip.js"></script>
    <script type="text/javascript" src="../dist/jszip-utils.js"></script>
    
    <script type="text/javascript">
    "use strict";
    var params = URLSearchParams && new URLSearchParams(document.location.search.substring(1));
    var zipuri = params && params.get("url");
    console.log("zipuri:", zipuri);
    // 1) get a promise of the content
    var promise = new JSZip.external.Promise(function (resolve, reject) {
        JSZipUtils.getBinaryContent(zipuri, function(err, data) {
            if (err) {
                console.error("getBinaryContent err:", err);
                reject(err);
            } else {
                resolve(data);
            }
        });
    });

    promise.then(JSZip.loadAsync)                         // 2) chain with the zip promise
        .then(function(zip) {
            return zip.file("Hello.txt").async("string"); // 3) chain with the text content promise
        })
        .then(function success(text) {                    // 4) display the result
            $("#jszip_utils").append($("<p>", {
                "class": "alert alert-success",
                text: "loaded, content = " + text
            }));
        }, function error(e) {
            $("#jszip_utils").append($("<p>", {
                "class": "alert alert-danger",
                text: e
            }));
        });
    </script>
  </head>
  <body>
    <div id="jszip_utils"></div>
  </body>
</html>
